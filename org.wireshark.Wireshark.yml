app-id: org.wireshark.Wireshark
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: wireshark
rename-icon: wireshark
rename-desktop-file: wireshark.desktop
rename-appdata-file: wireshark.appdata.xml
finish-args:
  - --socket=x11
  - --share=ipc
  - --socket=wayland
  - --device=dri
  # Because the file chooser somehow doesn't show the files on the host, we export some directory for reading pcap files
  # https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=15507
  - --filesystem=xdg-public-share
  - --filesystem=home:ro
  # - --share=network


modules:
  - name: libssh
    cleanup:
      - /include
      - /share
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://www.libssh.org/files/0.8/libssh-0.8.9.tar.xz
        sha256: 8559e19da0c40b6f93482b6160219ad77a4d9f1dc190bf174757455c6ae26825
        x-checker-data:
          type: anitya
          project-id: 1729
          url-template: https://git.libssh.org/projects/libssh.git/snapshot/libssh-$version.tar.gz


  - name: c-ares
    cleanup:
      - /include
      - /share
    sources:
      - type: archive
        url: https://c-ares.haxx.se/download/c-ares-1.15.0.tar.gz
        sha256: 6cdb97871f2930530c97deb7cf5c8fa4be5a0b02c7cea6e7c7667672a39d6852


  - name: nghttp2
    cleanup:
      - /include
      - /share
    sources:
      - type: archive
        url: https://github.com/nghttp2/nghttp2/releases/download/v1.36.0/nghttp2-1.36.0.tar.xz
        sha256: e9bb86157b88eda5a6844a232e039febbb52c1aa44b640acbbfabe729b8287fc


  - name: lua52
    disabled: true   # How to build lua5.2?
    sources:
      - type: archive
        url: https://www.lua.org/ftp/lua-5.2.4.tar.gz
        sha256: b9e2e4aad6789b3b63a056d442f7b39f0ecfca3ae0f1fc0ae4e9614401b69f4b


  - name: libmaxminddb
    cleanup:
      - /include
      - /share
    sources:
      - type: archive
        url: https://github.com/maxmind/libmaxminddb/releases/download/1.3.2/libmaxminddb-1.3.2.tar.gz
        sha256: e6f881aa6bd8cfa154a44d965450620df1f714c6dc9dd9971ad98f6e04f6c0f0

        # Taken from https://github.com/flathub/net.openra.OpenRA/blob/master/net.openra.OpenRA.yaml
        # I don't know whether we need this and if so, where to put those files
        #- type: file
        #  url: https://nuget.org/api/v2/package/MaxMind.Db/2.0.0
        #  dest-filename: thirdparty/download/MaxMind.Db.zip
        #  sha256: 98595abd21c735fe8bb84911a7b254f5d37c910818411f8edded7378e3e7c181

        #- type: file
        #  url: https://geolite.maxmind.com/download/geoip/database/GeoLite2-Country_20181211.tar.gz
        #  dest: thirdparty/download/
        #  sha256: 9e71cdb9cd870e1209001cbcfb0cb4dd3a58ff2d8ab85320682680aab0c250fc

  - name: snappy
    cleanup:
      - /share/doc
      - /include
    sources:
      - type: archive
        url: https://github.com/google/snappy/releases/download/1.1.3/snappy-1.1.3.tar.gz
        sha256: 2f1e82adf0868c9e26a5a7a3115111b6da7e432ddbac268a7ca2fae2a247eef3

  - name: lz4
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    cleanup:
      - /bin
      - /share/man
      - /include
      - /lib/pkgconfig
      - '*.a'
      - '*.so'
    sources:
      - type: archive
        url: https://github.com/lz4/lz4/archive/v1.9.2.tar.gz
        sha256: 658ba6191fa44c92280d4aa2c271b0f4fbc0e34d249578dd05e50e76d0e5efcc

  - name: bcg729
    cleanup:
      - /include
    sources:
      - type: git
        url: https://github.com/BelledonneCommunications/bcg729.git
        tag: 1.0.2
        commit: 23418135d21077bf41e71170179e4e3cb9723f8a

  - name: spandsp
    cleanup:
      - /include
    sources:
      - type: archive
        url: https://www.soft-switch.org/downloads/spandsp/spandsp-0.0.6.tar.gz
        mirror-urls:
          - https://gstreamer.freedesktop.org/src/mirror/spandsp-0.0.6.tar.gz
          - https://src.fedoraproject.org/lookaside/pkgs/spandsp/spandsp-0.0.6.tar.gz/897d839516a6d4edb20397d4757a7ca3/spandsp-0.0.6.tar.gz
          - https://sources.voidlinux.org/spandsp-0.0.6/spandsp-0.0.6.tar.gz
        sha256: cc053ac67e8ac4bb992f258fd94f275a7872df959f6a87763965feabfdcc9465

      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} config

  - name: sbc
    cleanup:
      - /include
    sources:
      - type: git
        url: https://git.kernel.org/pub/scm/bluetooth/sbc.git
        tag: '1.5'
        commit: dc6d23c0019985573e23d52b29371716c05a9481

      - type: patch
        path: b2c20a3ecf5ed00f63c94077a9762b505935ede9..909a9bdf7ab143e1f0baaf9736baebd3cd79aacf.patch

  - name: libpcap
    cleanup:
      - /include
      - /share
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://www.tcpdump.org/release/libpcap-1.9.0.tar.gz
        sha256: 2edb88808e5913fdaa8e9c1fcaf272e19b2485338742b5074b9fe44d68f37019


  - name: wireshark
    buildsystem: cmake-ninja

    cleanup:
      - /include
      - /share/man
      - /lib/pkgconfig

    sources:
        - type: archive
          url: https://1.eu.dl.wireshark.org/src/all-versions/wireshark-3.2.7.tar.xz
          sha256: be832fb86d9c455c5be8b225a755cdc77cb0e92356bdfc1fe4b000d93f7d70da
          x-data-checker:
            type: html
            url: https://www.wireshark.org/download.html
            version-pattern:  The current stable release of Wireshark is ([\d\.]+). 
            url-pattern: (https://1.eu.dl.wireshark.org/src/all-versions/wireshark-([\d\.]+).tar.xz)
